<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>National Senior Citizen Mediclaim Policy Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.22.9/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Ensure font supports ₹ symbol */
        body {
            font-family: 'Arial', 'Helvetica', sans-serif;
        }
        .rupee::before {
            content: '₹';
            font-family: 'Arial', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100 flex justify-center items-center min-h-screen">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        const rates = {
            "Zone 1": {
                "Plan A": {
                    "Individual": {
                        "100000": {"60-65": 9233, "66-70": 13851, "71-75": 15958, "76-80": 18250, "81-85": 22453, "86+": 24699},
                        "200000": {"60-65": 14431, "66-70": 21647, "71-75": 24938, "76-80": 28523, "81-85": 35084, "86+": 38594},
                        "300000": {"60-65": 17921, "66-70": 26882, "71-75": 30969, "76-80": 35420, "81-85": 43570, "86+": 47926},
                        "400000": {"60-65": 20589, "66-70": 30881, "71-75": 35576, "76-80": 40692, "81-85": 50050, "86+": 55056},
                        "500000": {"60-65": 24705, "66-70": 37057, "71-75": 42693, "76-80": 48830, "81-85": 60062, "86+": 66068},
                        "600000": {"60-65": 29507, "66-70": 44261, "71-75": 50990, "76-80": 58320, "81-85": 71734, "86+": 78909},
                        "700000": {"60-65": 34860, "66-70": 52290, "71-75": 60240, "76-80": 68898, "81-85": 84793, "86+": 93271},
                        "800000": {"60-65": 38345, "66-70": 57518, "71-75": 66264, "76-80": 75788, "81-85": 93271, "86+": 102598},
                        "900000": {"60-65": 39930, "66-70": 59895, "71-75": 69002, "76-80": 78920, "81-85": 97125, "86+": 106835},
                        "1000000": {"60-65": 41128, "66-70": 61693, "71-75": 71071, "76-80": 81289, "81-85": 100039, "86+": 110043}
                    },
                    "Dependent": {
                        "100000": {"50-55": 2122, "56-60": 3543, "61-65": 5343, "66-70": 8302, "71-75": 9915, "76-80": 11760, "81-85": 14469, "86+": 15915},
                        "200000": {"50-55": 3316, "56-60": 5538, "61-65": 8351, "66-70": 12974, "71-75": 15495, "76-80": 18379, "81-85": 22608, "86+": 24868},
                        "300000": {"50-55": 4118, "56-60": 6877, "61-65": 10371, "66-70": 16112, "71-75": 19242, "76-80": 22824, "81-85": 28076, "86+": 30882},
                        "400000": {"50-55": 4731, "56-60": 7901, "61-65": 11915, "66-70": 18509, "71-75": 22104, "76-80": 26220, "81-85": 32252, "86+": 35476},
                        "500000": {"50-55": 5677, "56-60": 9480, "61-65": 14297, "66-70": 22210, "71-75": 26526, "76-80": 31465, "81-85": 38704, "86+": 42572},
                        "600000": {"50-55": 6781, "56-60": 11323, "61-65": 17076, "66-70": 26528, "71-75": 31682, "76-80": 37579, "81-85": 46226, "86+": 50846},
                        "700000": {"50-55": 8011, "56-60": 13378, "61-65": 20174, "66-70": 31340, "71-75": 37429, "76-80": 44396, "81-85": 54640, "86+": 60100},
                        "800000": {"50-55": 8812, "56-60": 14715, "61-65": 22190, "66-70": 34474, "71-75": 41172, "76-80": 48835, "81-85": 60104, "86+": 66110},
                        "900000": {"50-55": 9176, "56-60": 15323, "61-65": 23108, "66-70": 35898, "71-75": 42873, "76-80": 50854, "81-85": 62587, "86+": 68841},
                        "1000000": {"50-55": 9452, "56-60": 15783, "61-65": 23801, "66-70": 36976, "71-75": 44159, "76-80": 52380, "81-85": 64465, "86+": 70908}
                    }
                },
                "Plan B": {
                    "Individual": {
                        "100000": {"60-65": 12004, "66-70": 18007, "71-75": 20745, "76-80": 23725, "81-85": 29190, "86+": 32108},
                        "200000": {"60-65": 18760, "66-70": 28141, "71-75": 32419, "76-80": 37079, "81-85": 45610, "86+": 50172},
                        "300000": {"60-65": 23297, "66-70": 34946, "71-75": 40261, "76-80": 46047, "81-85": 56640, "86+": 62304},
                        "400000": {"60-65": 26765, "66-70": 40146, "71-75": 46250, "76-80": 52899, "81-85": 65066, "86+": 71573},
                        "500000": {"60-65": 32115, "66-70": 48174, "71-75": 55501, "76-80": 63479, "81-85": 78079, "86+": 85888},
                        "600000": {"60-65": 38360, "66-70": 57539, "71-75": 66288, "76-80": 75815, "81-85": 93255, "86+": 102582},
                        "700000": {"60-65": 45318, "66-70": 67977, "71-75": 78311, "76-80": 89568, "81-85": 110230, "86+": 121252},
                        "800000": {"60-65": 49848, "66-70": 74773, "71-75": 86142, "76-80": 98525, "81-85": 121252, "86+": 133377},
                        "900000": {"60-65": 51908, "66-70": 77863, "71-75": 89703, "76-80": 102596, "81-85": 126262, "86+": 138887},
                        "1000000": {"60-65": 53466, "66-70": 80200, "71-75": 92393, "76-80": 105675, "81-85": 130050, "86+": 143056}
                    },
                    "Dependent": {
                        "100000": {"50-55": 2758, "56-60": 4607, "61-65": 6946, "66-70": 10793, "71-75": 12891, "76-80": 15289, "81-85": 18810, "86+": 20690},
                        "200000": {"50-55": 4311, "56-60": 7198, "61-65": 10856, "66-70": 16866, "71-75": 20143, "76-80": 23893, "81-85": 29391, "86+": 32329},
                        "300000": {"50-55": 5355, "56-60": 8940, "61-65": 13483, "66-70": 20944, "71-75": 25015, "76-80": 29671, "81-85": 36500, "86+": 40147},
                        "400000": {"50-55": 6151, "56-60": 10272, "61-65": 15490, "66-70": 24062, "71-75": 28736, "76-80": 34087, "81-85": 41929, "86+": 46120},
                        "500000": {"50-55": 7381, "56-60": 12325, "61-65": 18585, "66-70": 28873, "71-75": 34483, "76-80": 40904, "81-85": 50314, "86+": 55344},
                        "600000": {"50-55": 8815, "56-60": 14721, "61-65": 22199, "66-70": 34487, "71-75": 41187, "76-80": 48854, "81-85": 60093, "86+": 66100},
                        "700000": {"50-55": 10415, "56-60": 17391, "61-65": 26227, "66-70": 40743, "71-75": 48657, "76-80": 57715, "81-85": 71032, "86+": 78131},
                        "800000": {"50-55": 11456, "56-60": 19128, "61-65": 28848, "66-70": 44816, "71-75": 53523, "76-80": 63486, "81-85": 78135, "86+": 85944},
                        "900000": {"50-55": 11929, "56-60": 19920, "61-65": 30040, "66-70": 46667, "71-75": 55735, "76-80": 66110, "81-85": 81363, "86+": 89494},
                        "1000000": {"50-55": 12288, "56-60": 20518, "61-65": 30942, "66-70": 48068, "71-75": 57405, "76-80": 68094, "81-85": 83805, "86+": 92179}
                    }
                }
            },
            "Zone 2": {
                "Plan A": {
                    "Individual": {
                        "100000": {"60-65": 7802, "66-70": 11704, "71-75": 13484, "76-80": 15422, "81-85": 18973, "86+": 20871},
                        "200000": {"60-65": 12194, "66-70": 18291, "71-75": 21073, "76-80": 24102, "81-85": 29646, "86+": 32612},
                        "300000": {"60-65": 15143, "66-70": 22715, "71-75": 26169, "76-80": 29930, "81-85": 36816, "86+": 40498},
                        "400000": {"60-65": 17397, "66-70": 26095, "71-75": 30062, "76-80": 34385, "81-85": 42292, "86+": 46523},
                        "500000": {"60-65": 20876, "66-70": 31313, "71-75": 36075, "76-80": 41261, "81-85": 50752, "86+": 55828},
                        "600000": {"60-65": 24933, "66-70": 37400, "71-75": 43087, "76-80": 49280, "81-85": 60616, "86+": 66678},
                        "700000": {"60-65": 29457, "66-70": 44185, "71-75": 50903, "76-80": 58219, "81-85": 71650, "86+": 78814},
                        "800000": {"60-65": 32401, "66-70": 48603, "71-75": 55993, "76-80": 64041, "81-85": 78814, "86+": 86695},
                        "900000": {"60-65": 33741, "66-70": 50611, "71-75": 58307, "76-80": 66688, "81-85": 82071, "86+": 90276},
                        "1000000": {"60-65": 34753, "66-70": 52130, "71-75": 60055, "76-80": 68689, "81-85": 84533, "86+": 92986}
                    },
                    "Dependent": {
                        "100000": {"50-55": 1793, "56-60": 2994, "61-65": 4515, "66-70": 7015, "71-75": 8379, "76-80": 9937, "81-85": 12225, "86+": 13449},
                        "200000": {"50-55": 2802, "56-60": 4679, "61-65": 7056, "66-70": 10963, "71-75": 13094, "76-80": 15531, "81-85": 19103, "86+": 21014},
                        "300000": {"50-55": 3480, "56-60": 5811, "61-65": 8763, "66-70": 13614, "71-75": 16261, "76-80": 19287, "81-85": 23723, "86+": 26096},
                        "400000": {"50-55": 3998, "56-60": 6676, "61-65": 10067, "66-70": 15640, "71-75": 18679, "76-80": 22157, "81-85": 27251, "86+": 29978},
                        "500000": {"50-55": 4797, "56-60": 8011, "61-65": 12080, "66-70": 18767, "71-75": 22416, "76-80": 26588, "81-85": 32702, "86+": 35974},
                        "600000": {"50-55": 5729, "56-60": 9568, "61-65": 14428, "66-70": 22416, "71-75": 26773, "76-80": 31755, "81-85": 39058, "86+": 42966},
                        "700000": {"50-55": 6769, "56-60": 11304, "61-65": 17046, "66-70": 26482, "71-75": 31629, "76-80": 37515, "81-85": 46168, "86+": 50786},
                        "800000": {"50-55": 7445, "56-60": 12434, "61-65": 18749, "66-70": 29130, "71-75": 34792, "76-80": 41267, "81-85": 50784, "86+": 55865},
                        "900000": {"50-55": 7753, "56-60": 12948, "61-65": 19525, "66-70": 30334, "71-75": 36230, "76-80": 42972, "81-85": 52883, "86+": 58172},
                        "1000000": {"50-55": 7986, "56-60": 13336, "61-65": 20111, "66-70": 31244, "71-75": 37316, "76-80": 44262, "81-85": 54470, "86+": 59918}
                    }
                },
                "Plan B": {
                    "Individual": {
                        "100000": {"60-65": 10142, "66-70": 15214, "71-75": 17530, "76-80": 20048, "81-85": 24664, "86+": 27132},
                        "200000": {"60-65": 15852, "66-70": 23779, "71-75": 27393, "76-80": 31333, "81-85": 38539, "86+": 42395},
                        "300000": {"60-65": 19686, "66-70": 29529, "71-75": 34020, "76-80": 38909, "81-85": 47861, "86+": 52647},
                        "400000": {"60-65": 22617, "66-70": 33922, "71-75": 39081, "76-80": 44700, "81-85": 54980, "86+": 60480},
                        "500000": {"60-65": 27138, "66-70": 40706, "71-75": 46898, "76-80": 53639, "81-85": 65977, "86+": 72576},
                        "600000": {"60-65": 32413, "66-70": 48620, "71-75": 56013, "76-80": 64064, "81-85": 78800, "86+": 86681},
                        "700000": {"60-65": 38294, "66-70": 57441, "71-75": 66174, "76-80": 75685, "81-85": 93144, "86+": 102457},
                        "800000": {"60-65": 42122, "66-70": 63183, "71-75": 72791, "76-80": 83253, "81-85": 102457, "86+": 112704},
                        "900000": {"60-65": 43863, "66-70": 65794, "71-75": 75798, "76-80": 86694, "81-85": 106692, "86+": 117359},
                        "1000000": {"60-65": 45179, "66-70": 67770, "71-75": 78072, "76-80": 89295, "81-85": 109893, "86+": 120882}
                    },
                    "Dependent": {
                        "100000": {"50-55": 2332, "56-60": 3892, "61-65": 5869, "66-70": 9120, "71-75": 10892, "76-80": 12918, "81-85": 15893, "86+": 17483},
                        "200000": {"50-55": 3643, "56-60": 6083, "61-65": 9173, "66-70": 14253, "71-75": 17022, "76-80": 20191, "81-85": 24834, "86+": 27318},
                        "300000": {"50-55": 4523, "56-60": 7555, "61-65": 11392, "66-70": 17616, "71-75": 21138, "76-80": 25072, "81-85": 30840, "86+": 33924},
                        "400000": {"50-55": 5197, "56-60": 8679, "61-65": 13087, "66-70": 20331, "71-75": 24284, "76-80": 28805, "81-85": 35427, "86+": 38973},
                        "500000": {"50-55": 6236, "56-60": 10414, "61-65": 15704, "66-70": 24398, "71-75": 29141, "76-80": 34564, "81-85": 42513, "86+": 46766},
                        "600000": {"50-55": 7449, "56-60": 12437, "61-65": 18756, "66-70": 29141, "71-75": 34806, "76-80": 41282, "81-85": 50776, "86+": 55856},
                        "700000": {"50-55": 8800, "56-60": 14695, "61-65": 22160, "66-70": 34427, "71-75": 41119, "76-80": 48770, "81-85": 60019, "86+": 66022},
                        "800000": {"50-55": 9680, "56-60": 16163, "61-65": 24374, "66-70": 37869, "71-75": 45230, "76-80": 53647, "81-85": 66019, "86+": 72624},
                        "900000": {"50-55": 10079, "56-60": 16831, "61-65": 25383, "66-70": 39435, "71-75": 47099, "76-80": 55865, "81-85": 68748, "86+": 75624},
                        "1000000": {"50-55": 10382, "56-60": 17337, "61-65": 26144, "66-70": 40617, "71-75": 48511, "76-80": 57540, "81-85": 70823, "86+": 77905}
                    }
                }
            }
        };

        const pa_rates = {
            "100000": 90, "200000": 180, "300000": 270, "400000": 360, "500000": 450,
            "600000": 540, "700000": 630, "800000": 720, "900000": 810, "1000000": 900
        };

        const ci_rates = {
            "100000": {"50-55": 1359, "56-59": 2536, "60-65": 3639, "66-70": 7804, "71-75": 13074, "76-80": 19653, "81-85": 21618, "86+": 24861},
            "200000": {"50-55": 2718, "56-59": 5071, "60-65": 7278, "66-70": 15607, "71-75": 26148, "76-80": 39306, "81-85": 43236, "86+": 49722},
            "300000": {"50-55": 4077, "56-59": 7607, "60-65": 10917, "66-70": 23411, "71-75": 39222, "76-80": 58958, "81-85": 64854, "86+": 74582},
            "400000": {"50-55": 5436, "56-59": 10143, "60-65": 14556, "66-70": 31214, "71-75": 52296, "76-80": 78611, "81-85": 86472, "86+": 99443},
            "500000": {"50-55": 6795, "56-59": 12679, "60-65": 18196, "66-70": 39018, "71-75": 65371, "76-80": 98264, "81-85": 108090, "86+": 124304},
            "600000": {"50-55": 8153, "56-59": 15214, "60-65": 21835, "66-70": 46822, "71-75": 78445, "76-80": 117917, "81-85": 129708, "86+": 149165},
            "700000": {"50-55": 9512, "56-59": 17750, "60-65": 25474, "66-70": 54625, "71-75": 91519, "76-80": 137570, "81-85": 151327, "86+": 174025},
            "800000": {"50-55": 10871, "56-59": 20286, "60-65": 29113, "66-70": 62429, "71-75": 104593, "76-80": 157222, "81-85": 172945, "86+": 198886},
            "900000": {"50-55": 12230, "56-59": 22822, "60-65": 32752, "66-70": 70232, "71-75": 117667, "76-80": 176875, "81-85": 194563, "86+": 223747},
            "1000000": {"50-55": 13589, "56-59": 25357, "60-65": 36391, "66-70": 78036, "71-75": 130741, "76-80": 196528, "81-85": 216181, "86+": 248608}
        };

        const outpatient_rates = {
            "2000": 1400, "4000": 2800, "5000": 3500, "7500": 5250, "10000": 7000, "15000": 10500
        };

        const installment_rates = {
            "Half-Yearly": [0.525, 0.50],
            "Quarterly": [0.285, 0.25, 0.25, 0.25]
        };

        const sumInsuredOptions = ["100000", "200000", "300000", "400000", "500000", "600000", "700000", "800000", "900000", "1000000"];
        const outpatientOptions = ["0", "2000", "4000", "5000", "7500", "10000", "15000"];

        const App = () => {
            const [policyType, setPolicyType] = useState("Individual");
            const [zone, setZone] = useState("Zone 1");
            const [planType, setPlanType] = useState("Plan A");
            const [copayment, setCopayment] = useState("0");
            const [tpa, setTpa] = useState(true);
            const [installment, setInstallment] = useState("None");
            const [familyMembers, setFamilyMembers] = useState([{
                id: Date.now(),
                name: "",
                age: "",
                gender: "Male",
                relationship: "Self",
                sumInsured: "100000",
                diabetic: false,
                hypertension: false,
                outpatient: "0",
                paSi: "0",
                ciSi: "0",
                premium: "0"
            }]);
            const [results, setResults] = useState([]);
            const [summary, setSummary] = useState("Premium will be displayed here");
            const [alert, setAlert] = useState(null);

            const showAlert = (type, message) => {
                setAlert({ type, message });
                setTimeout(() => setAlert(null), 3000);
            };

            const getAgeGroup = (age) => {
                if (age >= 50 && age <= 55) return "50-55";
                if (age >= 56 && age <= 59) return "56-60";
                if (age >= 60 && age <= 65) return "61-65";
                if (age >= 66 && age <= 70) return "66-70";
                if (age >= 71 && age <= 75) return "71-75";
                if (age >= 76 && age <= 80) return "76-80";
                if (age >= 81 && age <= 85) return "81-85";
                return "86+";
            };

            const validateAge = (age, index) => {
                if (!age) return true;
                const parsedAge = parseInt(age);
                if (isNaN(parsedAge)) {
                    showAlert("error", "Age must be a valid number");
                    return false;
                }

                const relationship = familyMembers[index].relationship;
                if (parsedAge < 50) {
                    showAlert("error", "Minimum age for all members is 50 years");
                    return false;
                }
                if (relationship === "Self" && parsedAge < 60) {
                    showAlert("error", "Self must be 60 or older for both Individual and Floater policies");
                    return false;
                }
                if (parsedAge > 80) {
                    showAlert("warning", "Entry age shall be between 60-80 for fresh policy");
                }
                if (policyType === "Individual" && parsedAge < 60) {
                    showAlert("error", "All members must be 60 or older for Individual policy");
                    return false;
                }
                if (policyType === "Floater" && relationship === "Spouse" && parsedAge < 50) {
                    showAlert("error", "Spouse must be 50 or older in Floater policy");
                    return false;
                }
                return true;
            };

            const checkMedicalConditions = (index) => {
                const { diabetic, hypertension } = familyMembers[index];
                if (diabetic || hypertension) {
                    showAlert("info", "Copay 10% for either one & 25% for Both");
                }
            };

            const updateGender = (index) => {
                const relationship = familyMembers[index].relationship;
                const genderMap = {
                    Son: "Male",
                    Daughter: "Female",
                    Father: "Male",
                    Mother: "Female"
                };
                if (genderMap[relationship]) {
                    updateFamilyMember(index, "gender", genderMap[relationship]);
                }
            };

            const updateFamilyMember = (index, key, value) => {
                setFamilyMembers(prev => {
                    const newMembers = [...prev];
                    newMembers[index] = { ...newMembers[index], [key]: value };
                    return newMembers;
                });
            };

            const updateRelationshipOptions = () => {
                setFamilyMembers(prev => {
                    return prev.map((member, index) => {
                        let relationship = member.relationship;
                        if (policyType === "Individual") {
                            relationship = index === 0 ? "Self" : "Spouse";
                        } else {
                            relationship = index === 0 ? "Self" : (relationship === "Self" ? "Spouse" : relationship);
                        }
                        const newMember = { ...member, relationship };
                        updateGender(index);
                        return newMember;
                    });
                });
                updateSumInsuredOptions();
            };

            const updateSumInsuredOptions = () => {
                setFamilyMembers(prev => {
                    return prev.map((member, index) => {
                        let sumInsured = member.sumInsured;
                        let paSi = member.paSi;
                        let ciSi = member.ciSi;
                        if (!sumInsuredOptions.includes(sumInsured)) {
                            sumInsured = sumInsuredOptions[0];
                        }
                        if (policyType === "Floater" && index > 0) {
                            sumInsured = prev[0].sumInsured;
                        }
                        const paCiOptions = ["0", ...sumInsuredOptions.filter(si => parseInt(si) <= parseInt(sumInsured))];
                        if (!paCiOptions.includes(paSi)) paSi = "0";
                        if (!paCiOptions.includes(ciSi)) ciSi = "0";
                        return { ...member, sumInsured, paSi, ciSi };
                    });
                });
            };

            const addFamilyRow = () => {
                setFamilyMembers(prev => [
                    ...prev,
                    {
                        id: Date.now(),
                        name: "",
                        age: "",
                        gender: "Male",
                        relationship: policyType === "Individual" ? "Spouse" : "Spouse",
                        sumInsured: policyType === "Floater" ? prev[0].sumInsured : "100000",
                        diabetic: false,
                        hypertension: false,
                        outpatient: "0",
                        paSi: "0",
                        ciSi: "0",
                        premium: "0"
                    }
                ]);
                updateSumInsuredOptions();
            };

            const deleteFamilyRow = (index) => {
                if (familyMembers.length <= 1) {
                    showAlert("error", "At least 1 family member is required");
                    return;
                }
                setFamilyMembers(prev => prev.filter((_, i) => i !== index));
                updateSumInsuredOptions();
            };

            const calculatePremium = () => {
                for (let i = 0; i < familyMembers.length; i++) {
                    if (!familyMembers[i].name) {
                        showAlert("error", `Name is required for member ${i + 1}`);
                        return;
                    }
                    if (!familyMembers[i].age) {
                        showAlert("error", `Age is required for member ${i + 1}`);
                        return;
                    }
                    if (!validateAge(familyMembers[i].age, i)) {
                        updateFamilyMember(i, "age", "");
                        return;
                    }
                }

                let totalBasePremium = 0;
                let totalPaPremium = 0;
                let totalCiPremium = 0;
                let outpatientPremium = 0;
                const copaymentDiscount = 1 - (parseInt(copayment) / 100);
                const tpaLoading = tpa ? 0.035 : 0;
                const newResults = [];

                const updatedMembers = familyMembers.map(member => {
                    const age = parseInt(member.age) || 0;
                    const si = member.sumInsured;
                    const relationship = member.relationship;
                    const diabetic = member.diabetic;
                    const hypertension = member.hypertension;
                    const outpatientSi = member.outpatient;
                    const paSi = member.paSi;
                    const ciSi = member.ciSi;

                    const ageGroup = getAgeGroup(age);
                    const rateType = relationship === "Self" || policyType === "Individual" ? "Individual" : "Dependent";

                    let basePremium;
                    try {
                        basePremium = rates[zone][planType][rateType][si][ageGroup];
                    } catch (e) {
                        showAlert("error", `Invalid rate for ${rateType}, SI: ${si}, Age: ${ageGroup} in ${zone}, ${planType}`);
                        return member;
                    }

                    let medicalLoading = 0;
                    if (diabetic && hypertension) medicalLoading = 0.30;
                    else if (diabetic || hypertension) medicalLoading = 0.135;

                    basePremium *= (1 + medicalLoading);
                    totalBasePremium += basePremium;

                    let outpatientMemberPremium = 0;
                    if (outpatientSi !== "0") {
                        outpatientMemberPremium = outpatient_rates[outpatientSi];
                        outpatientPremium += outpatientMemberPremium;
                    }

                    let paPremium = 0;
                    if (paSi !== "0") {
                        paPremium = pa_rates[paSi];
                        totalPaPremium += paPremium;
                    }

                    let ciPremium = 0;
                    if (ciSi !== "0") {
                        ciPremium = ci_rates[ciSi][ageGroup];
                        totalCiPremium += ciPremium;
                    }

                    const rowPremium = basePremium + outpatientMemberPremium + paPremium + ciPremium;
                    newResults.push({
                        leftDesc: `${member.name} (Base Premium)`,
                        rightDesc: `Outpatient: <span class="rupee"></span>${outpatientSi}, PA: <span class="rupee"></span>${paSi}, CI: <span class="rupee"></span>${ciSi}`,
                        amount: `<span class="rupee"></span>${Math.floor(rowPremium)}`
                    });

                    return { ...member, premium: Math.floor(rowPremium).toString() };
                });

                let totalPremium = (totalBasePremium + outpatientPremium + totalPaPremium + totalCiPremium) * copaymentDiscount;
                const tpaLoadingAmount = totalPremium * tpaLoading;
                totalPremium += tpaLoadingAmount;

                const gst = totalPremium * 0.18;
                const finalPremium = totalPremium + gst;

                if (tpaLoadingAmount > 0) {
                    newResults.push({ leftDesc: "TPA Loading (3.5%)", rightDesc: "", amount: `<span class="rupee"></span>${Math.floor(tpaLoadingAmount)}` });
                }
                newResults.push({ leftDesc: "Subtotal", rightDesc: "", amount: `<span class="rupee"></span>${Math.floor(totalPremium)}` });
                newResults.push({ leftDesc: "GST (18%)", rightDesc: "", amount: `<span class="rupee"></span>${Math.floor(gst)}` });
                newResults.push({ leftDesc: "Total Premium", rightDesc: "", amount: `<span class="rupee"></span>${Math.floor(finalPremium)}` });

                let installmentAmounts = [];
                if (installment_rates[installment]) {
                    installmentAmounts = installment_rates[installment].map(rate => finalPremium * rate);
                    const labels = installment_rates[installment].map((rate, i) => 
                        `${["1st", "2nd", "3rd", "4th"][i]} Installment (${rate * 100}%)`
                    );
                    labels.forEach((label, i) => {
                        newResults.push({ leftDesc: label, rightDesc: "", amount: `<span class="rupee"></span>${Math.floor(installmentAmounts[i])}` });
                    });
                }

                setFamilyMembers(updatedMembers);
                setResults(newResults);

                let summaryText = `Total Premium: <span class="rupee"></span>${Math.floor(finalPremium)}`;
                if (installmentAmounts.length) {
                    if (installment === "Half-Yearly") {
                        summaryText += ` (Half Yearly: 1st <span class="rupee"></span>${Math.floor(installmentAmounts[0])}, 2nd <span class="rupee"></span>${Math.floor(installmentAmounts[1])})`;
                    } else if (installment === "Quarterly") {
                        summaryText += ` (Quarterly: 1st <span class="rupee"></span>${Math.floor(installmentAmounts[0])}, 2nd <span class="rupee"></span>${Math.floor(installmentAmounts[1])}, 3rd <span class="rupee"></span>${Math.floor(installmentAmounts[2])}, 4th <span class="rupee"></span>${Math.floor(installmentAmounts[3])})`;
                    }
                }
                setSummary(summaryText);
            };

            const resetFields = () => {
                setPolicyType("Individual");
                setZone("Zone 1");
                setPlanType("Plan A");
                setCopayment("0");
                setTpa(true);
                setInstallment("None");
                setFamilyMembers([{
                    id: Date.now(),
                    name: "",
                    age: "",
                    gender: "Male",
                    relationship: "Self",
                    sumInsured: "100000",
                    diabetic: false,
                    hypertension: false,
                    outpatient: "0",
                    paSi: "0",
                    ciSi: "0",
                    premium: "0"
                }]);
                setResults([]);
                setSummary("Premium will be displayed here");
            };

            useEffect(() => {
                updateRelationshipOptions();
            }, [policyType]);

            useEffect(() => {
                const cities = {
                    "Zone 1": "Gujarat, Delhi NCT, Mumbai, Nagpur, Pune",
                    "Zone 2": "Rest of India"
                };
                if (zone === "Zone 2") {
                    showAlert("info", "Zonal Copay 18.5% if treated in Zone 1");
                }
            }, [zone]);

            const getPaCiOptions = (sumInsured) => {
                return ["0", ...sumInsuredOptions.filter(si => parseInt(si) <= parseInt(sumInsured))];
            };

            return (
                <div className="bg-white p-6 rounded-lg shadow-lg w-full max-w-4xl">
                    {alert && (
                        <div className={`fixed top-4 right-4 p-4 rounded text-white ${alert.type === "error" ? "bg-red-500" : alert.type === "warning" ? "bg-yellow-500" : "bg-blue-500"}`}>
                            {alert.message}
                        </div>
                    )}
                    <h1 className="text-2xl font-bold text-blue-900 mb-4 text-center">
                        National Senior Citizen Mediclaim Policy Calculator
                    </h1>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium">Policy Type</label>
                            <select
                                value={policyType}
                                onChange={e => setPolicyType(e.target.value)}
                                className="w-full p-2 border rounded text-sm"
                            >
                                <option value="Individual">Individual</option>
                                <option value="Floater">Floater</option>
                            </select>
                        </div>
                        <div>
                            <label className="block text-sm font-medium">Zone</label>
                            <select
                                value={zone}
                                onChange={e => setZone(e.target.value)}
                                className="w-full p-2 border rounded text-sm"
                            >
                                <option value="Zone 1">Zone 1</option>
                                <option value="Zone 2">Zone 2</option>
                            </select>
                            <p className="text-xs text-gray-600 mt-1">
                                {zone === "Zone 1" ? "Gujarat, Delhi NCT, Mumbai, Nagpur, Pune" : "Rest of India"}
                            </p>
                        </div>
                        <div className="flex items-center">
                            <input
                                type="checkbox"
                                checked={tpa}
                                onChange={e => setTpa(e.target.checked)}
                                className="mr-2"
                            />
                            <label className="text-sm font-medium">TPA (3.5%)</label>
                        </div>
                        <div>
                            <label className="block text-sm font-medium">Plan</label>
                            <select
                                value={planType}
                                onChange={e => setPlanType(e.target.value)}
                                className="w-full p-2 border rounded text-sm"
                            >
                                <option value="Plan A">Plan A</option>
                                <option value="Plan B">Plan B</option>
                            </select>
                        </div>
                        <div>
                            <label className="block text-sm font-medium">Co-pay (%)</label>
                            <select
                                value={copayment}
                                onChange={e => setCopayment(e.target.value)}
                                className="w-full p-2 border rounded text-sm"
                            >
                                <option value="0">0</option>
                                <option value="10">10</option>
                                <option value="20">20</option>
                            </select>
                        </div>
                        <div>
                            <label className="block text-sm font-medium">Installment</label>
                            <select
                                value={installment}
                                onChange={e => setInstallment(e.target.value)}
                                className="w-full p-2 border rounded text-sm"
                            >
                                <option value="None">None</option>
                                <option value="Half-Yearly">Half-Yearly</option>
                                <option value="Quarterly">Quarterly</option>
                            </select>
                        </div>
                    </div>
                    <div className="mb-4">
                        <h2 className="text-lg font-semibold mb-2">Family Members</h2>
                        <div className="overflow-x-auto">
                            <table className="w-full text-sm">
                                <thead className="bg-green-100">
                                    <tr>
                                        <th className="p-2">Name</th>
                                        <th className="p-2">Age</th>
                                        <th className="p-2">Gender</th>
                                        <th className="p-2">Rel.</th>
                                        <th className="p-2">SI</th>
                                        <th className="p-2">Diab.</th>
                                        <th className="p-2">Hyp.</th>
                                        <th className="p-2">Outpatient</th>
                                        <th className="p-2">PA SI</th>
                                        <th className="p-2">CI SI</th>
                                        <th className="p-2">Premium</th>
                                        <th className="p-2">Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {familyMembers.map((member, index) => (
                                        <tr key={member.id} className="border-b">
                                            <td className="p-2">
                                                <input
                                                    type="text"
                                                    value={member.name}
                                                    onChange={e => updateFamilyMember(index, "name", e.target.value)}
                                                    className="w-full p-1 border rounded text-sm"
                                                />
                                            </td>
                                            <td className="p-2">
                                                <input
                                                    type="number"
                                                    value={member.age}
                                                    onChange={e => updateFamilyMember(index, "age", e.target.value)}
                                                    onBlur={e => {
                                                        if (!validateAge(e.target.value, index)) {
                                                            updateFamilyMember(index, "age", "");
                                                        }
                                                    }}
                                                    className="w-full p-1 border rounded text-sm"
                                                    min="0"
                                                />
                                            </td>
                                            <td className="p-2">
                                                <select
                                                    value={member.gender}
                                                    onChange={e => updateFamilyMember(index, "gender", e.target.value)}
                                                    disabled={["Son", "Daughter", "Father", "Mother"].includes(member.relationship)}
                                                    className="w-full p-1 border rounded text-sm"
                                                >
                                                    <option value="Male">Male</option>
                                                    <option value="Female">Female</option>
                                                </select>
                                            </td>
                                            <td className="p-2">
                                                <select
                                                    value={member.relationship}
                                                    onChange={e => {
                                                        updateFamilyMember(index, "relationship", e.target.value);
                                                        updateGender(index);
                                                    }}
                                                    disabled={index === 0 && policyType === "Floater"}
                                                    className="w-full p-1 border rounded text-sm"
                                                >
                                                    {index === 0 && policyType === "Floater" ? (
                                                        <option value="Self">Self</option>
                                                    ) : policyType === "Individual" ? (
                                                        <>
                                                            <option value="Self">Self</option>
                                                            <option value="Spouse">Spouse</option>
                                                        </>
                                                    ) : (
                                                        <>
                                                            <option value="Spouse">Spouse</option>
                                                            <option value="Son">Son</option>
                                                            <option value="Daughter">Daughter</option>
                                                            <option value="Father">Father</option>
                                                            <option value="Mother">Mother</option>
                                                        </>
                                                    )}
                                                </select>
                                            </td>
                                            <td className="p-2">
                                                <select
                                                    value={member.sumInsured}
                                                    onChange={e => updateFamilyMember(index, "sumInsured", e.target.value)}
                                                    disabled={policyType === "Floater" && index > 0}
                                                    className="w-full p-1 border rounded text-sm"
                                                >
                                                    {sumInsuredOptions.map(option => (
                                                        <option key={option} value={option}><span className="rupee"></span>{option}</option>
                                                    ))}
                                                </select>
                                            </td>
                                            <td className="p-2 text-center">
                                                <input
                                                    type="checkbox"
                                                    checked={member.diabetic}
                                                    onChange={e => {
                                                        updateFamilyMember(index, "diabetic", e.target.checked);
                                                        checkMedicalConditions(index);
                                                    }}
                                                />
                                            </td>
                                            <td className="p-2 text-center">
                                                <input
                                                    type="checkbox"
                                                    checked={member.hypertension}
                                                    onChange={e => {
                                                        updateFamilyMember(index, "hypertension", e.target.checked);
                                                        checkMedicalConditions(index);
                                                    }}
                                                />
                                            </td>
                                            <td className="p-2">
                                                <select
                                                    value={member.outpatient}
                                                    onChange={e => updateFamilyMember(index, "outpatient", e.target.value)}
                                                    className="w-full p-1 border rounded text-sm"
                                                >
                                                    {outpatientOptions.map(option => (
                                                        <option key={option} value={option}><span className="rupee"></span>{option}</option>
                                                    ))}
                                                </select>
                                            </td>
                                            <td className="p-2">
                                                <select
                                                    value={member.paSi}
                                                    onChange={e => updateFamilyMember(index, "paSi", e.target.value)}
                                                    className="w-full p-1 border rounded text-sm"
                                                >
                                                    {getPaCiOptions(member.sumInsured).map(option => (
                                                        <option key={option} value={option}><span className="rupee"></span>{option}</option>
                                                    ))}
                                                </select>
                                            </td>
                                            <td className="p-2">
                                                <select
                                                    value={member.ciSi}
                                                    onChange={e => updateFamilyMember(index, "ciSi", e.target.value)}
                                                    className="w-full p-1 border rounded text-sm"
                                                >
                                                    {getPaCiOptions(member.sumInsured).map(option => (
                                                        <option key={option} value={option}><span className="rupee"></span>{option}</option>
                                                    ))}
                                                </select>
                                            </td>
                                            <td className="p-2 text-center"><span className="rupee"></span>{member.premium}</td>
                                            <td className="p-2 text-center">
                                                {index > 0 && (
                                                    <button
                                                        onClick={() => deleteFamilyRow(index)}
                                                        className="text-red-500 hover:text-red-700"
                                                    >
                                                        Del
                                                    </button>
                                                )}
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                        <div className="mt-4 flex space-x-2">
                            <button
                                onClick={addFamilyRow}
                                className="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 text-sm"
                            >
                                Add Row
                            </button>
                            <button
                                onClick={calculatePremium}
                                className="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 text-sm"
                            >
                                Calculate
                            </button>
                            <button
                                onClick={resetFields}
                                className="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 text-sm"
                            >
                                Reset
                            </button>
                        </div>
                    </div>
                    <div className="mb-4">
                        <h2 className="text-lg font-semibold mb-2">Results</h2>
                        <div className="overflow-x-auto border rounded">
                            <table className="w-full text-sm">
                                <thead className="bg-green-100">
                                    <tr>
                                        <th className="p-2 text-left">Description (Base)</th>
                                        <th className="p-2 text-left">Optional Covers</th>
                                        <th className="p-2 text-left">Amount</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {results.map((result, index) => (
                                        <tr key={index} className="border-b hover:bg-blue-50">
                                            <td className="p-2">{result.leftDesc}</td>
                                            <td className="p-2" dangerouslySetInnerHTML={{ __html: result.rightDesc }}></td>
                                            <td className="p-2" dangerouslySetInnerHTML={{ __html: result.amount }}></td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                        <div className="mt-4 p-2 bg-blue-100 text-blue-900 font-semibold text-center rounded" dangerouslySetInnerHTML={{ __html: summary }}></div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById("root"));
    </script>
</body>
</html>
